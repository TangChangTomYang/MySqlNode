#### 自关联

- 设计省信息的表结构 provinces
    - id
    - ptitle
- 设计市信息的表结构 citys
    - id
    - ctitle
    - proid
- citys 表的proid表示城市所属的省, 对应着 provinces表的id
- 问题: 能不能将2张表合成一张表呢? 
- 思考: 观察两张表发现, citys表比provinces表多一个列, 其它的类型都是一样的.
- 意义: 存储的都是地区信息, 而且每种信息的数据量有限, 没必要增加一个新表, 或者将来还要存储区、乡镇信息, 都增加新表的开销太大.

- 答案: 定义表areas, 结构如下:
    - id 
    - atitle
    - pid
- 因为省没有所属的省份, 所以可以填写为 null
- 城市所属的省份pid, 填写省所对应的编号id
- 这就是自关联, 表中的某一列, 关联了表中的另外一列, 但是他们的业务逻辑含义是不一样的, 城市信息的pid 引用的是省信息的id
- 在这个表中, 结构不变, 可以添加区县、乡镇、村社等信息.



有很多应用里面的表,其实都是使用的自关联表实现的.如下: 
![](/assets/Snip20190527_1.png)


**示例:  自关联表**

|aid| atitle|pid|
|-|-|-|
|130000|河北省||
|130100|石家庄市|130000|
|130400|邯郸市|130000|
|130600|保定市|130000|
|130700|张家口市|130000|
|130800|承德市|130000|
|410000|河南省| |
|410100|郑州市|410000|
|410300|洛阳市|410000|
|410500|安阳市|410000|



例1: 查询河南省的所有城市

**说明: 同一个表在一条sql语句中可以查询多次, 只是要取别名以示区分**
```
// from 后的表名被称为 '数据源', 相同的数据源要取别名
select 
    * 
from 
    areas as sheng , 
    aerea as shi
where  
    shi.pid = sheng.aid
    and sheng.atitle="河南省";
```

例2: 查询所有的省
```
// 省份是没有 pid 的
select * from areas where areas.pid is null;
```